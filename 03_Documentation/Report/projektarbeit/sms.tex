\chapter{SMs tests}

% Event handler

\begin{figure}[ht]
    \centering
    \begin{tikzpicture}[->,>=stealth']
        %   Event Handler
        % Position of Start 
        % Use previously defined 'state' as layout (see above)
        % use tabular for content to get columns/rows
        % parbox to limit width of the listing
        \node[state,
            text width=3.2cm 	
            ] (EV_START) 
        {
            \begin{tabular}{l}
            \textbf{Start}\\[.1em]
            
        \end{tabular}
        };
    
      % STATE E_WAIT
      \node[state,
      text width=3.2cm,
          below of=EV_START,
          %yshift=-2cm,
          node distance=3.5cm, 
          anchor=center ] (EV_WAIT) 
        {
          \begin{tabular}{l}
          \textbf{Waiting}\\[.1em]
          \parbox{3cm}{
              \textbf{entry:}\\
              $osWaitEvent()$\\
              \textbf{exit:}
              }
      \end{tabular}
      };
    
        % State: Check
        \node[state,    	% layout (defined above)
            text width=3.2cm, 	% max text width
            yshift=-2cm, 		% move 2cm in y
            xshift=1cm,
            right of=EV_WAIT, 	% Position is to the right of QUERY
            node distance=4.5cm, 	% distance to QUERY
            anchor=center] (EV_CHCK) 	% posistion relative to the center of the 'box'
        {%
        \begin{tabular}{l} 	% content
            \textbf{Check signal}\\[.1em]
            \parbox{2.8cm}{
                \textbf{entry:}\\
                $check(signal)$\\
                \textbf{exit:}\\
                }
        \end{tabular}
        };
    
        % STATE EV_FAULT
        \node[state,
            text width=3.8cm,
            right of=EV_CHCK,
            xshift=1.5cm,
            node distance=4.5cm,
            anchor=center] (EV_FAULT) 
        {%
        \begin{tabular}{l}
        \textbf{Fault}\\[.1em]
        \parbox{4cm}{
            \textbf{entry:}\\[.1em]
            $sysError = TRUE$\\
            $osThreadSuspend()$\\
            \textbf{exit:}
            }
        \end{tabular}
        };
    
        % STATE ERROR HANDLER
        % Use previously defined 'state' as layout (see above)
        % use tabular for content to get columns/rows
        % parbox to limit width of the listing
        \node[state,
            text width=3.8cm,
            above of = EV_CHCK,
            xshift = 3cm,
            yshift = 1cm,
            node distance = 3.5cm,
            anchor = center] (EV_HANDLER_ERROR) 
        {\begin{tabular}{l}
            \textbf{Error handler}\\[.1em]
            \parbox{4cm}{
                \textbf{entry:}\\[.1em]
                $checkPriority(error)$\\
                $ledChangeColor()$\\
                $updState()$\\
                \textbf{exit:}\\[.1em]
                $osReset(Flag)$
                } 
        \end{tabular}};
    
        % STATE EVENT HANDLER
        % Use previously defined 'state' as layout (see above)
        % use tabular for content to get columns/rows
        % parbox to limit width of the listing
        \node[state,
            text width=3.8cm,
            below of = EV_WAIT,
            %xshift = -3cm,
            yshift = -1.5cm,
            node distance = 3.5cm,
            anchor = center] (EV_HANDLER_EVENT) 
        {\begin{tabular}{l}
            \textbf{Event handler}\\[.1em]
            \parbox{4cm}{
                \textbf{entry:}\\[.1em]
                $isEcatCmd()$
                $checkPriority(event)$\\
                $ledChangeColor()$\\
                $updState()$\\
                \textbf{exit:}\\[.1em]
                $osEventReset(Flag)$
                } 
        \end{tabular}};
            
    
        %STATE ECAT CMD
        \node[state,
        text width = 3.2cm,
        below of=EV_CHCK,
        yshift= 0.5cm,
        xshift = 1cm,
        node distance=4.5cm,
        anchor=center] (EV_ECATCMD) 
        {%
        \begin{tabular}{l}
        \textbf{Ecat cmd}\\[.1em]
        \parbox{4cm}{
            \textbf{entry:}\\
            $idEcatCmd()$\\[.1em]
            \textbf{exit:}
            }
        \end{tabular}
        };
    
        % EV_START
        % EV_WAIT
        % EV_CHCK
        % EV_FAULT
        % EV_HANDLER_ERROR
        % EV_HANDLER_EVENT
        % EV_ECATCMD
        % draw the paths and and print some Text below/above the graph
        \path
            (EV_START)       edge node[anchor=center,left]{$osOK$}  (EV_WAIT) 
            (EV_WAIT) 	    edge[bend left=20]  node[anchor=north,above]{$sys\_event?$} (EV_CHCK)
            (EV_CHCK)     	edge[bend right=20] node[anchor=north,right]{$errorID$} (EV_HANDLER_ERROR)
            (EV_CHCK)       	edge  node[anchor=center,above]{$unknownID$}     (EV_FAULT)
            (EV_CHCK)       	edge[bend left=20] node[anchor=center,right]{$eventID$}   (EV_HANDLER_EVENT)
            % (E_CONNECTED)   edge            node[anchor=north,above]{$soes$}     
            %                                 node[anchor=south,below]{$timeout$}(E_FAULT)
            (EV_HANDLER_ERROR)   edge[bend right=30]  node[anchor=center,above]{$done$}   (EV_WAIT)
            (EV_HANDLER_ERROR)   edge[bend left=30]  node[anchor=center,right]{$fault$}   (EV_FAULT)
            % (E_FAULT)  	    edge            node[anchor=north,above]{$thread$} 
            %                                 node[anchor=center,below]{$removed?$}   (E_RESTART)
            (EV_HANDLER_EVENT)  	edge  node[anchor=center,right]{$done$}     (EV_WAIT)
            (EV_HANDLER_EVENT)  	edge[bend right=10] node[anchor=center,below]{$event==cmd$}(EV_ECATCMD)     
                                                        %node[anchor=center,below]{$==cmd$}
            (EV_HANDLER_EVENT)  	edge[bend right=70] node[anchor=center,below]{$fault$}     (EV_FAULT)
            (EV_ECATCMD)  	edge[bend right=10]  node[anchor=center,right]{$cmdID$}     (EV_CHCK)
            ;
    
        \end{tikzpicture}
    \caption{State machine for Event Handler functionality.}
    \label{fig:sm_event}
\end{figure}





%LED DSM
\begin{figure}[ht]
    \centering
    %Her comes the figure
    \begin{tikzpicture}[->,>=stealth']
        %   LED DSM
        % Position of Start 
        % Use previously defined 'state' as layout (see above)
        % use tabular for content to get columns/rows
        % parbox to limit width of the listing
        \node[state,
            text width=3.2cm 	
            ] (L_START) 
        {
            \begin{tabular}{l}
            \textbf{Start}\\[.1em]
            
        \end{tabular}
        };
    
      % STATE L_CONFIG
      \node[state,
      text width=3.2cm,
          below of=L_START,
          %yshift=-2cm,
          node distance=3.5cm, 
          anchor=center ] (L_CONFIG) 
        {
          \begin{tabular}{l}
          \textbf{Config}\\[.1em]
          \parbox{3cm}{
              \textbf{entry:}\\
              $config(chs)$\\
              $setInitColor()$
              \textbf{exit:}
              }
      \end{tabular}
      };
    
    
        % State: L_SEND
        \node[state,    	% layout (defined above)
            text width=3.2cm, 	% max text width
            yshift=-2cm, 		% move 2cm in y
            xshift=1cm,
            right of=L_CONFIG, 	% Position is to the right of QUERY
            node distance=4.5cm, 	% distance to QUERY
            anchor=center] (L_SEND) 	% posistion relative to the center of the 'box'
        {%
        \begin{tabular}{l} 	% content
            \textbf{Send data}\\[.1em]
            \parbox{2.8cm}{
                \textbf{entry:}\\
                $send(chs)$\\
                \textbf{exit:}\\
                $osTimer1Start()$
                }
        \end{tabular}
        };
    
        % STATE L_WAIT_REFRESH
        \node[state,
            text width=3.8cm,
            above of=L_SEND,
            %xshift=1.5cm,
            node distance=4.5cm,
            anchor=center] (L_WAIT_REFRESH) 
        {%
        \begin{tabular}{l}
        \textbf{Wait refresh}\\[.1em]
        \parbox{4cm}{
            \textbf{entry:}\\[.1em]
            $osTimer2Start()$\\
            \textbf{exit:}
            }
        \end{tabular}
        };
    
    
    
    
        % STATE L_C_UPDATE
        % Use previously defined 'state' as layout (see above)
        % use tabular for content to get columns/rows
        % parbox to limit width of the listing
        \node[state,
            text width=3.4cm,
            right of = L_SEND,
            xshift = 1cm,
            %yshift = -1.5cm,
            node distance = 4.5cm,
            anchor = center] (L_C_UPDATE) 
        {\begin{tabular}{l}
            \textbf{Update color}\\[.1em]
            \parbox{4cm}{
                \textbf{entry:}\\[.1em]
                $check(sysState)$
                $setColor(chs)$\\
                \textbf{exit:}\\[.1em]
                $isEffectOn()$
                } 
        \end{tabular}};
    
    
        % STATE 
        % Use previously defined 'state' as layout (see above)
        % use tabular for content to get columns/rows
        % parbox to limit width of the listing
        \node[state,
            text width=3.2cm,
            below of = L_C_UPDATE,
            xshift = -2.5cm,
            %yshift = -3.5cm,
            node distance = 4cm,
            anchor = center] (L_WAIT_DMA) 
        {\begin{tabular}{l}
            \textbf{Wait DMA}\\[.1em]
            \parbox{4cm}{
                \textbf{entry:}\\[.1em]
                $osWaitEvent()$\\
                \textbf{exit:}\\
                $osTimer1Stop()$
                } 
        \end{tabular}};
    
        %STATE L_EFFECT
        \node[state,
        text width = 3.2cm,
        above of=L_C_UPDATE,
        yshift= 1cm,
        %xshift = 1cm,
        node distance=3.5cm,
        anchor=center] (L_EFFECT) 
        {%
        \begin{tabular}{l}
        \textbf{Effect}\\[.1em]
        \parbox{4cm}{
            \textbf{entry:}\\
            $updtEffect()$\\
            \textbf{exit:}
            }
        \end{tabular}
        };
    
            %STATE L_RESTART
        \node[state,
        text width = 3.2cm,
        below of=L_SEND,
        %yshift= 0.5cm,
        xshift = -2.5cm,
        node distance=4cm,
        anchor=center] (L_RESTART) 
        {%
        \begin{tabular}{l}
        \textbf{Restart}\\[.1em]
        \parbox{4cm}{
            \textbf{entry:}\\
            $restart(chs)$\\
            \textbf{exit:}
            }
        \end{tabular}
        };
    
        % L_START
        % L_CONFIG
        % L_WAIT_DMA
        % L_SEND
        % L_C_UPDATE
        % L_WAIT_REFRESH
        % L_EFFECT
        % L_RESTART  
    
        % draw the paths and and print some Text below/above the graph
        \path
            (L_START)       edge node[anchor=center,left]{$osOK$}  (L_CONFIG) 
            (L_CONFIG) 	    edge[bend left=25]  node[anchor=north,above]{$sys\_event!$} (L_SEND)
            (L_SEND)     	edge[bend right=10] node[anchor=north,right]{$done$} (L_WAIT_DMA)
            (L_WAIT_DMA)       	edge[bend right=20]  node[anchor=center,right]{$dmaDone$}     (L_C_UPDATE)
            (L_WAIT_DMA)       	edge  node[anchor=center,below]{$timeout$}     (L_RESTART)
            (L_C_UPDATE)       	edge[bend right=10] node[anchor=center,right]{$effectOff$}   (L_WAIT_REFRESH)
            (L_C_UPDATE)   edge node[anchor=center,right]{$effectOn$}   (L_EFFECT)
            (L_EFFECT)   edge  node[anchor=center,above]{$done$}   (L_WAIT_REFRESH)
            % (E_FAULT)  	    edge            node[anchor=north,above]{$thread$} 
            %                                 node[anchor=center,below]{$removed?$}   (E_RESTART)
            (L_WAIT_REFRESH)  	edge  node[anchor=center,right]{$timeElapsed$}     (L_SEND)
            % (L_SEND)  	edge[bend right=10] node[anchor=center,below]{$event==cmd$}(EV_ECATCMD)     
            %                                             %node[anchor=center,below]{$==cmd$}
            (L_SEND)  	edge[bend left=25] node[anchor=center,left]{$sendFault$}     (L_RESTART)
            (L_RESTART)  	edge[bend left=35]  node[anchor=center,right]{$done$}     (L_CONFIG)
            ;
    
        \end{tikzpicture}
    \caption{State machine for LED Ring control functionality}
    \label{fig:sm_led}
\end{figure}




\begin{figure}[ht]
    \centering
    \subfigure[Synchronization state machine]{\label{subfig:ecat_sm}{
        %General state machine 80/100
        \begin{tikzpicture}[->,>=stealth']
        % Position of QUERY 
        % Use previously defined 'state' as layout (see above)
        % use tabular for content to get columns/rows
        % parbox to limit width of the listing
        \node[state,
            text width=3.2cm 	
            ] (E_CONFIG) 
        {\begin{tabular}{l}
            \textbf{Config}\\[.1em]
            \parbox{4cm}{
            \textbf{entry:}\\
            $init(SPI)$\\
            $open(soesPort)$\\
            \textbf{exit:}
            }
        \end{tabular}};
  
        % STATE START 
        % Use previously defined 'state' as layout (see above)
        % use tabular for content to get columns/rows
        % parbox to limit width of the listing
        \node[state,
            text width=3.2cm,
            above of = E_CONFIG,
            node distance = 3.5cm,
            anchor = center] (E_START) 
        {\begin{tabular}{l}
            \textbf{Start}\\[.1em]
            
        \end{tabular}};
  
  
            
        % State: ACK with different content
        \node[state,    	% layout (defined above)
            text width=3.4cm, 	% max text width
            yshift=2cm, 		% move 2cm in y
            right of=E_CONFIG, 	% Position is to the right of QUERY
            node distance=5cm, 	% distance to QUERY
            anchor=center] (E_CHCK) 	% posistion relative to the center of the 'box'
        {%
        \begin{tabular}{l} 	% content
            \textbf{Check comm}\\[.1em]
            \parbox{2.8cm}{
                \textbf{entry:}\\
                $osTimerStart()$
                \textbf{exit:}\\
                $osResume(SOES)$
                }
        \end{tabular}
        };
        
        % STATE E_WAIT
        \node[state,
        text width=3.2cm,
            %below of=ACK,
            right of=E_CHCK,
            yshift=-2cm,
            node distance=5cm, 
            anchor=center ] (E_WAIT) 
        {%
        \begin{tabular}{l}
            \textbf{Waiting SOES}\\[.1em]
            \parbox{2.8cm}{
                \textbf{entry:}\\
                $osWaitEvent()$\\
                \textbf{exit:}
                }
        \end{tabular}
        };
        
  
        
        %STATE CONNECTED
        \node[state,
        text width = 3.5cm,
        below of=E_WAIT,
        xshift= 1cm,
        node distance=4.5cm,
        anchor=center] (E_CONNECTED) 
        {%
        \begin{tabular}{l}
        \textbf{Connected}\\[.1em]
        \parbox{4cm}{
            \textbf{entry:}\\
            $osResume(SOES)$\\[.1em]
            $updAppState()$\\
            $checkAppChange()$\\
            \textbf{exit:}
            }
        \end{tabular}
        };
  
        % STATE E_FAULT
        \node[state,
            text width=3.4cm,
            left of=E_CONNECTED,
            %xshift=-2.5cm,
            node distance=5.5cm,
            anchor=center] (E_FAULT) 
        {%
        \begin{tabular}{l}
        \textbf{Fault}\\[.1em]
        \parbox{4cm}{
            \textbf{entry:}\\
            $osRemove(SOES)$\\
            \textbf{exit:}\\
            $notifyError()$
            }
        \end{tabular}
        };
  
        %STATE RESTART
        \node[state,
        text width = 3.2cm,
        left of=E_FAULT,
        node distance=5.5cm,
        %xshift = 2cm,
        anchor=center] (E_RESTART) 
        {%
        \begin{tabular}{l}
        \textbf{Restart}\\[.1em]
        \parbox{4cm}{
            \textbf{entry:}\\
            $restart(SPI)$\\[.1em]
            $osRestart(SOES)$\\
            $osDelay()$\\
            \textbf{exit:}
            }
        \end{tabular}
        };
  
        % draw the paths and and print some Text below/above the graph
        \path
            (E_START)       edge node[anchor=center,left]{$osOk$}  (E_CONFIG) 
            (E_CONFIG) 	    edge[bend left=25]  node[anchor=center,above]{$sys\_event!$} (E_CHCK)
            (E_CHCK)     	edge[bend left=30] node[anchor=north,right]{$resume!$} (E_WAIT)
            (E_WAIT)       	edge[bend left=10]  node[anchor=center,right]{$comm?$}     (E_CONNECTED)
            (E_WAIT)       	edge[bend right=25] node[anchor=center,left]{$soesTimeout$}                                         (E_FAULT)
            (E_CONNECTED)   edge            node[anchor=north,above]{$soes$}     
                                            node[anchor=south,below]{$timeout$}(E_FAULT)
            (E_CONNECTED)   edge[loop below]  node[anchor=left,below]{$sys\_event!$}                   (E_CONNECTED)
            (E_FAULT)  	    edge            node[anchor=north,above]{$sys\_event!$} (E_RESTART)
            %                                node[anchor=center,below]{$removed?$}   (E_RESTART)
            (E_RESTART)  	edge[bend left=20]  node[anchor=center,right]{$delayDone$}                                          (E_CONFIG)
            ;
  
        \end{tikzpicture}
    }}\hfill
    \subfigure[SOES application state machine]{\label{subfig:soes_sm}{
        %SOES state machine 80/100
        \begin{tikzpicture}[->,>=stealth']
        % STATE 1 SOES
        % Use previously defined 'state' as layout (see above)
        % use tabular for content to get columns/rows
        % parbox to limit width of the listing
        \node[state,
            text width=3.2cm 	
            ] (SOES_INIT1) 
        {\begin{tabular}{l}
            \textbf{Init1}\\[.1em]
            \parbox{4cm}{
            
            $escInit()$\\
            
            }
        \end{tabular}};
            
        % STATE SOES INIT 2
        \node[state,    	% layout (defined above)
            text width=3.2cm, 	% max text width
            %yshift=2cm, 		% move 2cm in y
            below of=SOES_INIT1, 	
            node distance=3cm, 	% 
            anchor=center] (SOES_INIT2) 	% posistion relative to the center of the 'box'
        {%
        \begin{tabular}{l} 	% content
            \textbf{Init2}\\[.1em]
            \parbox{2.8cm}{
                $osSuspend()$\\
                }
        \end{tabular}
        };
  
        % STATE 0 SOES
        % Use previously defined 'state' as layout (see above)
        % use tabular for content to get columns/rows
        % parbox to limit width of the listing
        \node[state,
            text width=3.2cm,
            right of = SOES_INIT1,
            node distance = 5cm,
            anchor = center] (SOES_INIT0) 
        {\begin{tabular}{l}
            \textbf{Start}\\[.1em]
            \parbox{4cm}{
            
            }
        \end{tabular}};
        
        % STATE SET TIMER
        \node[state,
        text width=3.2cm,
            %below of=ACK,
            right of=SOES_INIT2,
            %yshift=-2cm,
            node distance=5cm, 
            anchor=center ] (SOES_TIMER) 
        {%
        \begin{tabular}{l}
            \textbf{Timer}\\[.1em]
            \parbox{2.8cm}{
                $osGetTick()$\\
                $osTimerStart()$
                }
        \end{tabular}
        };
        
  
        
        %STATE SLAVE LOOP
        \node[state,
        text width = 3.2cm,
        right of=SOES_TIMER,
        %xshift= 2.5cm,
        node distance=5cm,
        anchor=center] (SOES_SLAVE) 
        {%
        \begin{tabular}{l}
        \textbf{Slave loop}\\[.1em]
        \parbox{4cm}{
            $escRun()$\\
            }
        \end{tabular}
        };
  
        % STATE SOES_RESET TIMEOUT
        \node[state,
            text width=3.2cm,
            below of=SOES_SLAVE,
            xshift=-2.5cm,
            node distance=3cm,
            anchor=center] (SOES_RESET) 
        {%
        \begin{tabular}{l}
        \textbf{Timeout Reset}\\[.1em]
        \parbox{4cm}{
            $osTimerStop()$\\
            $osDelay()$\\
            }
        \end{tabular}
        };
  
        
        draw the paths and and print some Text below/above the graph
        \path
        (SOES_INIT0)    edge node[anchor=center,above]{$resume?$} (SOES_INIT1) 
        (SOES_INIT1) 	edge  node[anchor=south,right]{$comm!$}  (SOES_INIT2)
        (SOES_INIT1)    edge [loop above]   node[anchor=east,above]{$noCommLoop$} (SOES_INIT1)
        (SOES_INIT2)    edge node [anchor=center,above]{$resume?$} (SOES_TIMER)                                          (SOES_TIMER)
        (SOES_TIMER)    edge                   (SOES_SLAVE)
        (SOES_SLAVE)    edge [loop above]       node[anchor=center,above]{$noCommLoop$}       (SOES_SLAVE)
        (SOES_SLAVE)    edge [bend left = 50]   node[anchor=center,right]{$escUpdated$}   (SOES_RESET)
        (SOES_RESET)    edge [bend left = 50]   node[anchor=center,left]{$delayDone$}   (SOES_TIMER)
        ;
  
        \end{tikzpicture}
    }}
    \caption{State machines for EtherCAT slave functionality.} %EtherCAT Device Protocol poster from EtherCAT resources
    \label{fig:sm_ecatsoes}
  \end{figure} 

% \begin{figure}[ht]
%     \centering
%     \subfigure[Synchronization state machine]{\label{subfig:ecat_sm}{
%         %General state machine 80/100
%         \begin{tikzpicture}[->,>=stealth']
%         % Position of QUERY 
%         % Use previously defined 'state' as layout (see above)
%         % use tabular for content to get columns/rows
%         % parbox to limit width of the listing
%         \node[state,
%             text width=3.2cm 	
%             ] (E_CONFIG) 
%         {\begin{tabular}{l}
%             \textbf{Config}\\[.1em]
%             \parbox{4cm}{
%             \textbf{entry:}\\
%             $spi\_init()$\\
%             $open\_soesPort()$\\
%             \textbf{exit:}
%             }
%         \end{tabular}};

%         % STATE START 
%         % Use previously defined 'state' as layout (see above)
%         % use tabular for content to get columns/rows
%         % parbox to limit width of the listing
%         \node[state,
%             text width=3.2cm,
%             above of = E_CONFIG,
%             node distance = 3.5cm,
%             anchor = center] (E_START) 
%         {\begin{tabular}{l}
%             \textbf{Start}\\[.1em]
            
%         \end{tabular}};


            
%         % State: ACK with different content
%         \node[state,    	% layout (defined above)
%             text width=3.2cm, 	% max text width
%             yshift=2cm, 		% move 2cm in y
%             right of=E_CONFIG, 	% Position is to the right of QUERY
%             node distance=5cm, 	% distance to QUERY
%             anchor=center] (E_CHCK) 	% posistion relative to the center of the 'box'
%         {%
%         \begin{tabular}{l} 	% content
%             \textbf{Check comm}\\[.1em]
%             \parbox{2.8cm}{
%                 \textbf{entry:}\\
%                 $timeout\_start()$
%                 \textbf{exit:}\\
%                 $resume\_SOES()$
%                 }
%         \end{tabular}
%         };
        
%         % STATE E_WAIT
%         \node[state,
%         text width=3.2cm,
%             %below of=ACK,
%             right of=E_CHCK,
%             yshift=-2cm,
%             node distance=5cm, 
%             anchor=center ] (E_WAIT) 
%         {%
%         \begin{tabular}{l}
%             \textbf{Waiting SOES}\\[.1em]
%             \parbox{2.8cm}{
%                 \textbf{entry:}\\
%                 $osWaitEvent()$\\
%                 \textbf{exit:}
%                 }
%         \end{tabular}
%         };
        

        
%         %STATE CONNECTED
%         \node[state,
%         text width = 3.2cm,
%         below of=E_WAIT,
%         xshift= 2.5cm,
%         node distance=4.5cm,
%         anchor=center] (E_CONNECTED) 
%         {%
%         \begin{tabular}{l}
%         \textbf{Connected}\\[.1em]
%         \parbox{4cm}{
%             \textbf{entry:}\\
%             $osResume(SOES)$\\[.1em]
%             $update\_state()$\\
%             \textbf{exit:}
%             }
%         \end{tabular}
%         };

%         % STATE E_FAULT
%         \node[state,
%             text width=3.2cm,
%             below of=E_WAIT,
%             xshift=-2.5cm,
%             node distance=4.5cm,
%             anchor=center] (E_FAULT) 
%         {%
%         \begin{tabular}{l}
%         \textbf{Fault}\\[.1em]
%         \parbox{4cm}{
%             \textbf{entry:}\\
%             $notify\_error()$\\
%             $osThreadRemove()$\\
%             \textbf{exit:}
%             }
%         \end{tabular}
%         };

%         %STATE RESTART
%         \node[state,
%         text width = 3.2cm,
%         left of=E_FAULT,
%         node distance=5cm,
%         %xshift = 2cm,
%         anchor=center] (E_RESTART) 
%         {%
%         \begin{tabular}{l}
%         \textbf{Restart}\\[.1em]
%         \parbox{4cm}{
%             \textbf{entry:}\\
%             $deInit_SPI()$\\[.1em]
%             $restartSOES$\\
%             $delay()$
%             }
%         \end{tabular}
%         };

%         % draw the paths and and print some Text below/above the graph
%         \path
%             (E_START)       edge node[anchor=center,left]{$os\_ready$}  (E_CONFIG) 
%             (E_CONFIG) 	    edge[bend left=20]  node[anchor=north,above]{$port\_ok$} (E_CHCK)
%             (E_CHCK)     	edge[bend left=20] node[anchor=north,right]{$Resume!$} (E_WAIT)
%             (E_WAIT)       	edge[bend left=10]  node[anchor=center,right]{$Comm?$}     (E_CONNECTED)
%             (E_WAIT)       	edge[bend right=10] node[anchor=center,left]{$soes\_timeout$}                                         (E_FAULT)
%             (E_CONNECTED)   edge            node[anchor=north,above]{$soes$}     
%                                             node[anchor=south,below]{$timeout$}(E_FAULT)
%             (E_CONNECTED)   edge[loop below]  node[anchor=center,below]{$update\_loop$}                   (E_CONNECTED)
%             (E_FAULT)  	    edge            node[anchor=north,above]{$thread$} 
%                                             node[anchor=center,below]{$removed?$}   (E_RESTART)
%             (E_RESTART)  	edge[bend left=30]  node[anchor=center,left]{$delay\_done$}                                          (E_CONFIG)
%             ;

%         \end{tikzpicture}
%     }}\hfill
%     \subfigure[SOES application state machine]{\label{subfig:soes_sm}{
%         %SOES state machine 80/100
%         \begin{tikzpicture}[->,>=stealth']
%         % STATE 1 SOES
%         % Use previously defined 'state' as layout (see above)
%         % use tabular for content to get columns/rows
%         % parbox to limit width of the listing
%         \node[state,
%             text width=3.2cm 	
%             ] (SOES_INIT1) 
%         {\begin{tabular}{l}
%             \textbf{Init1}\\[.1em]
%             \parbox{4cm}{
            
%             $lib\_init()$\\
            
%             }
%         \end{tabular}};
            
%         % STATE SOES INIT 2
%         \node[state,    	% layout (defined above)
%             text width=3.2cm, 	% max text width
%             %yshift=2cm, 		% move 2cm in y
%             below of=SOES_INIT1, 	
%             node distance=3cm, 	% 
%             anchor=center] (SOES_INIT2) 	% posistion relative to the center of the 'box'
%         {%
%         \begin{tabular}{l} 	% content
%             \textbf{Init2}\\[.1em]
%             \parbox{2.8cm}{
%                 $suspend\_thread()$\\
%                 }
%         \end{tabular}
%         };

%         % STATE 0 SOES
%         % Use previously defined 'state' as layout (see above)
%         % use tabular for content to get columns/rows
%         % parbox to limit width of the listing
%         \node[state,
%             text width=3.2cm,
%             right of = SOES_INIT1,
%             node distance = 5cm,
%             anchor = center] (SOES_INIT0) 
%         {\begin{tabular}{l}
%             \textbf{Start}\\[.1em]
%             \parbox{4cm}{
            
%             }
%         \end{tabular}};
        
%         % STATE SET TIMER
%         \node[state,
%         text width=3.2cm,
%             %below of=ACK,
%             right of=SOES_INIT2,
%             %yshift=-2cm,
%             node distance=5cm, 
%             anchor=center ] (SOES_TIMER) 
%         {%
%         \begin{tabular}{l}
%             \textbf{Timer}\\[.1em]
%             \parbox{2.8cm}{
%                 $osGetTick()$\\
%                 $osStartTimeout()$
%                 }
%         \end{tabular}
%         };
        

        
%         %STATE SLAVE LOOP
%         \node[state,
%         text width = 3.2cm,
%         right of=SOES_TIMER,
%         %xshift= 2.5cm,
%         node distance=5cm,
%         anchor=center] (SOES_SLAVE) 
%         {%
%         \begin{tabular}{l}
%         \textbf{Slave loop}\\[.1em]
%         \parbox{4cm}{
%             $eca\_slv()$\\
%             }
%         \end{tabular}
%         };

%         % STATE SOES_RESET TIMEOUT
%         \node[state,
%             text width=3.2cm,
%             below of=SOES_SLAVE,
%             xshift=-2.5cm,
%             node distance=3cm,
%             anchor=center] (SOES_RESET) 
%         {%
%         \begin{tabular}{l}
%         \textbf{Timeout Reset}\\[.1em]
%         \parbox{4cm}{
%             $reset\_Timeout()$\\
%             $osDelay()$\\
%             }
%         \end{tabular}
%         };

        
%         draw the paths and and print some Text below/above the graph
%         \path
%         (SOES_INIT0)    edge node[anchor=center,above]{$Resume?$} (SOES_INIT1) 
%         (SOES_INIT1) 	edge  node[anchor=south,right]{$Comm!$}  (SOES_INIT2)
%         (SOES_INIT1)    edge [loop above]   node[anchor=east,above]{$no\_comm\_loop$} (SOES_INIT1)
%         (SOES_INIT2)    edge [loop below]   node[anchor=south,below]{$no\_eventFlag$} (SOES_INIT2)
%         (SOES_INIT2)    edge node [anchor=center,above]{$Resume?$} (SOES_TIMER)                                          (SOES_TIMER)
%         (SOES_TIMER)    edge                   (SOES_SLAVE)
%         (SOES_SLAVE)    edge [loop above]       node[anchor=center,above]{$no\_comm\_loop$}       (SOES_SLAVE)
%         (SOES_SLAVE)    edge [bend left = 50]   node[anchor=center,right]{$esc\_updated$}   (SOES_RESET)
%         (SOES_RESET)    edge [bend left = 50]   node[anchor=center,left]{$delay\_done$}   (SOES_TIMER)
%         ;

%         \end{tikzpicture}
%     }}
%     \caption{State machines for EtherCAT slave functionality} %EtherCAT Device Protocol poster from EtherCAT resources
%     \label{fig:syncmodes}
% \end{figure} 

% \begin{figure}[ht]
%     \centering
%     %Her comes the figure
%     \caption{This is a figure}
%     \label{fig:this_is_a_label}
% \end{figure}